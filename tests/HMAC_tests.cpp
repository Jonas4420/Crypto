#include <vector>

#include "gtest/gtest.h"
#include "gmock/gmock.h"

#include "crypto/HMAC.hpp"
#include "crypto/SHA1.hpp"
#include "crypto/SHA224.hpp"
#include "crypto/SHA256.hpp"
#include "crypto/Utils.hpp"

TEST(HMAC_SHA1, mac_test_vector)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f"
			"202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f",
			"53616d706c65202331",
			"4f4ca3d5d68ba7cc0a1208c9c61e9c5da0403c0a"
	       	}, {
			"303132333435363738393a3b3c3d3e3f40414243",
			"53616d706c65202332",
			"0922d3405faa3d194f82a45830737d5cc6c75d24"
		}, {
			"505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f"
			"707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f"
			"909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaea"
			"fb0b1b2b3",
			"53616d706c65202333",
			"bcf41eab8bb2d802f3d05caf7cb092ecf8d1a3aa"
		}, {
		       	"707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8"
			"f909192939495969798999a9b9c9d9e9fa0",
			"53616d706c65202334",
			"9ea886efe268dbecce420c75"
		}, {
			"7b10f4124b15c82e",
			"27dcb5b1daf60cfd3e2f73d4d64ca9c684f8bf71fc682a46793b1790afa4feb"
			"100ca7aaff26f58f0e1d0ed42f1cdad1f474afa2e79d53a0c42892c4d7b327c"
			"be46b295ed8da3b6ecab3d4851687a6f812b79df2f6b20f11f6706f5301790c"
			"a99625aad7391d84f78043d2a0a239b1477984c157bbc9276064e7a1a406b06"
			"12ca",
			"4ead12c2fe3d6ea43acb"
		}, {
			"4fe9fb902172a21b",
			"4ceb3a7c13659c22fe51134f03dce4c239d181b63c6b0b59d367157fd05cab9"
			"8384f92dfa482d2d5e78e72eef1b1838af4696026c54233d484ecbbe87f904d"
			"f5546419f8567eafd232e6c2fcd3ee2b7682c63000524b078dbb2096f585007"
			"deae752562df1fe3b01278089e16f3be46e2d0f7cabac2d8e6cc02a2d0ca953"
			"425f",
			"564428a67be1924b5793"
	       	}, {
			"d1f01455f78c4fb4",
			"00d40f67b57914bec456a3e3201ef1464be319a8d188c02e157af4b54f9b5a6"
			"6d67f898a9bdbb19ff63a80aba6f246d013575721d52eb1b47a65def884011c"
			"49b257bcc2817fc853f106e8138ce386d7a5ac3103de0a3fa0ed6bb7af9ff66"
			"ebd1cc46fb86e4da0013d20a3c2dcd8fb828a4b70f7f104b41bf3f44682a664"
			"97ea",
			"56a665a7cdfe610f9fc5"
		}, {
			"4e5ef77fdf033a5b",
			"e59326464e3201d195e29f2a3446ec1b1c9ff31154e2a4d0e40ed466f1bc855"
			"d29f76835624fa0127d29c9b1915939a046f385af7e5d47a23ba91f28bd22f8"
			"11ea258dbbf3332bcd3543b8285d5df41bd064ffd64a341c22c4edb44f9c8d9"
			"e6df0c59dbf4a052a6c83da7478e179a6f3839c6870ff8ca8b9497f9ac1d725"
			"fdda",
			"981c0a7a8423b63a8fa6"
		}, {
			"bcd9ff8aa60be2be",
			"51be4d0eb37bab714f92e19e9d70390655b363e8cd346a748245e731f437759"
			"cb8206412c8dab2ef1d4f36f880f41ff69d949da4594fdecb65e23cac1329b5"
			"9e69e29bf875b38c31df6fa546c595f35cc2192aa750679a8a51a65e00e839d"
			"73a8d8c598a610d237fbe78955213589d80efcb73b95b8586f96d17b6f51a71"
			"c3b8",
			"84633f9f5040c8971478"
		}, {
			"4a661bce6ed86d21",
			"5ff6c744f1aab1bc29697d71f67541b8b3cec3c7079183b10a83fb98a9ee251"
			"d4bac3e1cb581ca972aaed8efd7c2875a6fb4c991132f67c9742d45e53bc7e8"
			"eaa94b35b37a907be61086b426cd11088ac118934e85d968c9667fd69fc6f6e"
			"a38c0fe34710b7ece91211b9b7ea00acd31f022aa6726368f9928a1352f1222"
			"33f1",
			"739df59353ac6694e55e"
		}, {
			"1287e1565a57b547",
			"390ffdccc6171c11568d85b8f913e019bf4cd982ca9cd21ea730d41bdf3fcc0"
			"bc88ff48ba13a8f23deb2d96ec1033e7b2a58ca72b0c1e17bf03330db25d1e3"
			"60fa6918009c4294bd1215b5ccd159a8f58bc3dc3d490eb7c3b9f887e8c98db"
			"bb274a75373dcb695a59abd0219529d88518a96f92abc0bbcbda985c388f1fb"
			"bcc9",
			"d78ddf08077c7d9e2ba6"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out[Crypto::HMAC<Crypto::SHA1>::SIZE];
		std::string output;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC_get<Crypto::SHA1>(key, key_sz, in, in_sz, out);
		Crypto::Utils::to_hex(out, test[i][2].length() / 2, output, false);

		EXPECT_THAT(output, test[i][2]);
	}
}

TEST(HMAC_SHA1, reset_ctx)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f"
			"202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f",
			"53616d706c65202331",
			"4f4ca3d5d68ba7cc0a1208c9c61e9c5da0403c0a"
	       	}, {
			"303132333435363738393a3b3c3d3e3f40414243",
			"53616d706c65202332",
			"0922d3405faa3d194f82a45830737d5cc6c75d24"
		}, {
			"505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f"
			"707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f"
			"909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaea"
			"fb0b1b2b3",
			"53616d706c65202333",
			"bcf41eab8bb2d802f3d05caf7cb092ecf8d1a3aa"
		}, {
		       	"707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8"
			"f909192939495969798999a9b9c9d9e9fa0",
			"53616d706c65202334",
			"9ea886efe268dbecce420c75"
		}, {
			"7b10f4124b15c82e",
			"27dcb5b1daf60cfd3e2f73d4d64ca9c684f8bf71fc682a46793b1790afa4feb"
			"100ca7aaff26f58f0e1d0ed42f1cdad1f474afa2e79d53a0c42892c4d7b327c"
			"be46b295ed8da3b6ecab3d4851687a6f812b79df2f6b20f11f6706f5301790c"
			"a99625aad7391d84f78043d2a0a239b1477984c157bbc9276064e7a1a406b06"
			"12ca",
			"4ead12c2fe3d6ea43acb"
		}, {
			"4fe9fb902172a21b",
			"4ceb3a7c13659c22fe51134f03dce4c239d181b63c6b0b59d367157fd05cab9"
			"8384f92dfa482d2d5e78e72eef1b1838af4696026c54233d484ecbbe87f904d"
			"f5546419f8567eafd232e6c2fcd3ee2b7682c63000524b078dbb2096f585007"
			"deae752562df1fe3b01278089e16f3be46e2d0f7cabac2d8e6cc02a2d0ca953"
			"425f",
			"564428a67be1924b5793"
	       	}, {
			"d1f01455f78c4fb4",
			"00d40f67b57914bec456a3e3201ef1464be319a8d188c02e157af4b54f9b5a6"
			"6d67f898a9bdbb19ff63a80aba6f246d013575721d52eb1b47a65def884011c"
			"49b257bcc2817fc853f106e8138ce386d7a5ac3103de0a3fa0ed6bb7af9ff66"
			"ebd1cc46fb86e4da0013d20a3c2dcd8fb828a4b70f7f104b41bf3f44682a664"
			"97ea",
			"56a665a7cdfe610f9fc5"
		}, {
			"4e5ef77fdf033a5b",
			"e59326464e3201d195e29f2a3446ec1b1c9ff31154e2a4d0e40ed466f1bc855"
			"d29f76835624fa0127d29c9b1915939a046f385af7e5d47a23ba91f28bd22f8"
			"11ea258dbbf3332bcd3543b8285d5df41bd064ffd64a341c22c4edb44f9c8d9"
			"e6df0c59dbf4a052a6c83da7478e179a6f3839c6870ff8ca8b9497f9ac1d725"
			"fdda",
			"981c0a7a8423b63a8fa6"
		}, {
			"bcd9ff8aa60be2be",
			"51be4d0eb37bab714f92e19e9d70390655b363e8cd346a748245e731f437759"
			"cb8206412c8dab2ef1d4f36f880f41ff69d949da4594fdecb65e23cac1329b5"
			"9e69e29bf875b38c31df6fa546c595f35cc2192aa750679a8a51a65e00e839d"
			"73a8d8c598a610d237fbe78955213589d80efcb73b95b8586f96d17b6f51a71"
			"c3b8",
			"84633f9f5040c8971478"
		}, {
			"4a661bce6ed86d21",
			"5ff6c744f1aab1bc29697d71f67541b8b3cec3c7079183b10a83fb98a9ee251"
			"d4bac3e1cb581ca972aaed8efd7c2875a6fb4c991132f67c9742d45e53bc7e8"
			"eaa94b35b37a907be61086b426cd11088ac118934e85d968c9667fd69fc6f6e"
			"a38c0fe34710b7ece91211b9b7ea00acd31f022aa6726368f9928a1352f1222"
			"33f1",
			"739df59353ac6694e55e"
		}, {
			"1287e1565a57b547",
			"390ffdccc6171c11568d85b8f913e019bf4cd982ca9cd21ea730d41bdf3fcc0"
			"bc88ff48ba13a8f23deb2d96ec1033e7b2a58ca72b0c1e17bf03330db25d1e3"
			"60fa6918009c4294bd1215b5ccd159a8f58bc3dc3d490eb7c3b9f887e8c98db"
			"bb274a75373dcb695a59abd0219529d88518a96f92abc0bbcbda985c388f1fb"
			"bcc9",
			"d78ddf08077c7d9e2ba6"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out_1[Crypto::HMAC<Crypto::SHA1>::SIZE];
		uint8_t out_2[Crypto::HMAC<Crypto::SHA1>::SIZE];
		std::string output_1, output_2;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC<Crypto::SHA1> ctx(key, key_sz);
		ctx.update(in, in_sz);
		ctx.reset();
		ctx.update(in, in_sz);
		ctx.finish(out_1);
		Crypto::Utils::to_hex(out_1, test[i][2].length() / 2, output_1, false);

		ctx.update(in, in_sz);
		ctx.finish(out_2);
		Crypto::Utils::to_hex(out_2, test[i][2].length() / 2, output_2, false);

		EXPECT_THAT(output_1, test[i][2]);
		EXPECT_THAT(output_2, test[i][2]);
	}
}

TEST(HMAC_SHA224, mac_test_vector)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"e055eb756697ee573fd3214811a9f7fa",
			"3875847012ee42fe54a0027bdf38cca7021b83a2ed0503af69ef6c37c637bc11"
			"14fba40096c5947d736e19b7af3c68d95a4e3b8b073adbbb80f47e9db8f2d4f0"
			"018ddd847fabfdf9dd9b52c93e40458977725f6b7ba15f0816bb895cdf504012"
			"68f5d702b7e6a5f9faef57b8768c8a3fc14f9a4b3182b41d940e337d219b29ff",
			"40a453133361cc48da11baf616ee"
		}, {
			"88e5258b55b1623385eb9632fa7c57d6",
			"ada76bb604be14326551701cf30e48a65eee80b44f0b9d4a07b1844543b7844a"
			"621097fdc99de57387458ae9354899b620d0617eabcaefa9eef3d413a3362805"
			"4335ce656c26fa2986e0f111a6351096b283101ec7868871d770b370973c7405"
			"983f9756b3005a3eab492cfd0e7eb42e5c2e15fa6be8718c0a50acc4e5717230",
			"81c783af538015cef3c60095df53"
		}, {
			"85d402d822114d31abf75526e2538705",
			"8020d8d98cc2e2298b32879c51c751e1dd5558fe2eabb8f158604297d6d072ce"
			"2261a1d6830b7cfe2617b57c7126f99c9476211d6161acd75d266da217ec8174"
			"b80484c9dc6f0448a0a036a3fc82e8bf54bdb71549368258d5d41f57978a4c26"
			"6b92e8783ef66350215573d99be4089144b383ad8f3222bae8f3bf80ffb1bb2b",
			"2aa0340ac9deafe3be38129daca0"
		}, {
			"545c6eecc5ee46fa17c59f91a94f81ae",
			"8fb7f3565593170152ddb2021874784e951977cfdd22f8b72a72a61320a8f2a3"
			"5697b5e913f717805559b1af1861ee3ed42fb788481e4fd276b17bdbefcae7b4"
			"501dc5d20de5b7626dd5efdcd65294db4bdf682c33d9a9255c6435383fa5f1c8"
			"86326a3acbc6bd50a33ab5b2dbb034ce0112d4e226bbcd57e3731a519aa1d784",
			"3eb566eac54c4a3a9ef092469f24"
		}, {
			"4466ab4dc438841a9750c7f173dff02e",
			"2534c11c78c99cffaec8f722f04adc7045c7324d58ce98e37cfa94b6ed21ed7f"
			"58ce55379ef24b72d6d640ee9154f96c614734be9c408e225d7ba4cecc1179cc"
			"9f6e1808e1067aa8f244a99bd0c3267594c1887a40d167f8b7cf78db0d19f97b"
			"01fc50b8c86def490dfa7a5135002c33e71d77a8cce8ea0f93e0580439a33733",
			"59f44a9bbed4875b892d22d6b5ab"
		}, {
			"0e3dd9bb5e4cf0f09a4c11600af56d8d",
			"f4589fa76c328ea25cf8bae582026ba40a59d45a546ff31cf80eb826088f69bb"
			"954c452c74586836416dee90a5255bc5d56d3b405b3705a5197045688b32fa98"
			"4c3a3dfbdc9c2460a0b5e6312a624048bb6f170306535e9b371a3ab134a2642a"
			"230ad03d2c688cca80baeaee9a20e1d4c548b1cede29c6a45bf4df2c8c476f1a",
			"12175b93e3da4c58217145e4dc0a1cf142fab9319bb501e037b350ba"
		}, {
			"cda5187b0c5dcb0f8e5a8beed2306584",
			"9011ae29b44c49b347487ce972965f16ade3c15be0856ce9c853a9739dba07e4"
			"f20d594ddc1dfe21560a65a4e458cfa17745575b915a30c7a9412ff8d1d689db"
			"9680dd2428c27588bb0dc92d2cd9445fe8f44b840a197c52c3c4333fff455339"
			"45134398df6436513cfab06c924046b8c795a5bd92e8d5f2de85bf306f2eed67",
			"4aaba92b40e2a600feab176eb9b292d814864195c03342aad6f67f08"
		}, {
			"e055eb756697ee573fd3214811a9f7fa",
			"3875847012ee42fe54a0027bdf38cca7021b83a2ed0503af69ef6c37c637bc11"
			"14fba40096c5947d736e19b7af3c68d95a4e3b8b073adbbb80f47e9db8f2d4f0"
			"018ddd847fabfdf9dd9b52c93e40458977725f6b7ba15f0816bb895cdf504012"
			"68f5d702b7e6a5f9faef57b8768c8a3fc14f9a4b3182b41d940e337d219b29ff",
			"40a453133361cc48da11baf616ee"
		}, {
			"88e5258b55b1623385eb9632fa7c57d6",
			"ada76bb604be14326551701cf30e48a65eee80b44f0b9d4a07b1844543b7844a"
			"621097fdc99de57387458ae9354899b620d0617eabcaefa9eef3d413a3362805"
			"4335ce656c26fa2986e0f111a6351096b283101ec7868871d770b370973c7405"
			"983f9756b3005a3eab492cfd0e7eb42e5c2e15fa6be8718c0a50acc4e5717230",
			"81c783af538015cef3c60095df53"
		}, {
			"85d402d822114d31abf75526e2538705",
			"8020d8d98cc2e2298b32879c51c751e1dd5558fe2eabb8f158604297d6d072ce"
			"2261a1d6830b7cfe2617b57c7126f99c9476211d6161acd75d266da217ec8174"
			"b80484c9dc6f0448a0a036a3fc82e8bf54bdb71549368258d5d41f57978a4c26"
			"6b92e8783ef66350215573d99be4089144b383ad8f3222bae8f3bf80ffb1bb2b",
			"2aa0340ac9deafe3be38129daca0"
		}, {
			"545c6eecc5ee46fa17c59f91a94f81ae",
			"8fb7f3565593170152ddb2021874784e951977cfdd22f8b72a72a61320a8f2a3"
			"5697b5e913f717805559b1af1861ee3ed42fb788481e4fd276b17bdbefcae7b4"
			"501dc5d20de5b7626dd5efdcd65294db4bdf682c33d9a9255c6435383fa5f1c8"
			"86326a3acbc6bd50a33ab5b2dbb034ce0112d4e226bbcd57e3731a519aa1d784",
			"3eb566eac54c4a3a9ef092469f24"
		}, {
			"4466ab4dc438841a9750c7f173dff02e",
			"2534c11c78c99cffaec8f722f04adc7045c7324d58ce98e37cfa94b6ed21ed7f"
			"58ce55379ef24b72d6d640ee9154f96c614734be9c408e225d7ba4cecc1179cc"
			"9f6e1808e1067aa8f244a99bd0c3267594c1887a40d167f8b7cf78db0d19f97b"
			"01fc50b8c86def490dfa7a5135002c33e71d77a8cce8ea0f93e0580439a33733",
			"59f44a9bbed4875b892d22d6b5ab"
		}, {
			"0e3dd9bb5e4cf0f09a4c11600af56d8d",
			"f4589fa76c328ea25cf8bae582026ba40a59d45a546ff31cf80eb826088f69bb"
			"954c452c74586836416dee90a5255bc5d56d3b405b3705a5197045688b32fa98"
			"4c3a3dfbdc9c2460a0b5e6312a624048bb6f170306535e9b371a3ab134a2642a"
			"230ad03d2c688cca80baeaee9a20e1d4c548b1cede29c6a45bf4df2c8c476f1a",
			"12175b93e3da4c58217145e4dc0a1cf142fab9319bb501e037b350ba"
		}, {
			"cda5187b0c5dcb0f8e5a8beed2306584",
			"9011ae29b44c49b347487ce972965f16ade3c15be0856ce9c853a9739dba07e4"
			"f20d594ddc1dfe21560a65a4e458cfa17745575b915a30c7a9412ff8d1d689db"
			"9680dd2428c27588bb0dc92d2cd9445fe8f44b840a197c52c3c4333fff455339"
			"45134398df6436513cfab06c924046b8c795a5bd92e8d5f2de85bf306f2eed67",
			"4aaba92b40e2a600feab176eb9b292d814864195c03342aad6f67f08"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out[Crypto::HMAC<Crypto::SHA224>::SIZE];
		std::string output;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC_get<Crypto::SHA224>(key, key_sz, in, in_sz, out);
		Crypto::Utils::to_hex(out, test[i][2].length() / 2, output, false);

		EXPECT_THAT(output, test[i][2]);
	}
}

TEST(HMAC_SHA224, reset_ctx)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"e055eb756697ee573fd3214811a9f7fa",
			"3875847012ee42fe54a0027bdf38cca7021b83a2ed0503af69ef6c37c637bc11"
			"14fba40096c5947d736e19b7af3c68d95a4e3b8b073adbbb80f47e9db8f2d4f0"
			"018ddd847fabfdf9dd9b52c93e40458977725f6b7ba15f0816bb895cdf504012"
			"68f5d702b7e6a5f9faef57b8768c8a3fc14f9a4b3182b41d940e337d219b29ff",
			"40a453133361cc48da11baf616ee"
		}, {
			"88e5258b55b1623385eb9632fa7c57d6",
			"ada76bb604be14326551701cf30e48a65eee80b44f0b9d4a07b1844543b7844a"
			"621097fdc99de57387458ae9354899b620d0617eabcaefa9eef3d413a3362805"
			"4335ce656c26fa2986e0f111a6351096b283101ec7868871d770b370973c7405"
			"983f9756b3005a3eab492cfd0e7eb42e5c2e15fa6be8718c0a50acc4e5717230",
			"81c783af538015cef3c60095df53"
		}, {
			"85d402d822114d31abf75526e2538705",
			"8020d8d98cc2e2298b32879c51c751e1dd5558fe2eabb8f158604297d6d072ce"
			"2261a1d6830b7cfe2617b57c7126f99c9476211d6161acd75d266da217ec8174"
			"b80484c9dc6f0448a0a036a3fc82e8bf54bdb71549368258d5d41f57978a4c26"
			"6b92e8783ef66350215573d99be4089144b383ad8f3222bae8f3bf80ffb1bb2b",
			"2aa0340ac9deafe3be38129daca0"
		}, {
			"545c6eecc5ee46fa17c59f91a94f81ae",
			"8fb7f3565593170152ddb2021874784e951977cfdd22f8b72a72a61320a8f2a3"
			"5697b5e913f717805559b1af1861ee3ed42fb788481e4fd276b17bdbefcae7b4"
			"501dc5d20de5b7626dd5efdcd65294db4bdf682c33d9a9255c6435383fa5f1c8"
			"86326a3acbc6bd50a33ab5b2dbb034ce0112d4e226bbcd57e3731a519aa1d784",
			"3eb566eac54c4a3a9ef092469f24"
		}, {
			"4466ab4dc438841a9750c7f173dff02e",
			"2534c11c78c99cffaec8f722f04adc7045c7324d58ce98e37cfa94b6ed21ed7f"
			"58ce55379ef24b72d6d640ee9154f96c614734be9c408e225d7ba4cecc1179cc"
			"9f6e1808e1067aa8f244a99bd0c3267594c1887a40d167f8b7cf78db0d19f97b"
			"01fc50b8c86def490dfa7a5135002c33e71d77a8cce8ea0f93e0580439a33733",
			"59f44a9bbed4875b892d22d6b5ab"
		}, {
			"0e3dd9bb5e4cf0f09a4c11600af56d8d",
			"f4589fa76c328ea25cf8bae582026ba40a59d45a546ff31cf80eb826088f69bb"
			"954c452c74586836416dee90a5255bc5d56d3b405b3705a5197045688b32fa98"
			"4c3a3dfbdc9c2460a0b5e6312a624048bb6f170306535e9b371a3ab134a2642a"
			"230ad03d2c688cca80baeaee9a20e1d4c548b1cede29c6a45bf4df2c8c476f1a",
			"12175b93e3da4c58217145e4dc0a1cf142fab9319bb501e037b350ba"
		}, {
			"cda5187b0c5dcb0f8e5a8beed2306584",
			"9011ae29b44c49b347487ce972965f16ade3c15be0856ce9c853a9739dba07e4"
			"f20d594ddc1dfe21560a65a4e458cfa17745575b915a30c7a9412ff8d1d689db"
			"9680dd2428c27588bb0dc92d2cd9445fe8f44b840a197c52c3c4333fff455339"
			"45134398df6436513cfab06c924046b8c795a5bd92e8d5f2de85bf306f2eed67",
			"4aaba92b40e2a600feab176eb9b292d814864195c03342aad6f67f08"
		}, {
			"e055eb756697ee573fd3214811a9f7fa",
			"3875847012ee42fe54a0027bdf38cca7021b83a2ed0503af69ef6c37c637bc11"
			"14fba40096c5947d736e19b7af3c68d95a4e3b8b073adbbb80f47e9db8f2d4f0"
			"018ddd847fabfdf9dd9b52c93e40458977725f6b7ba15f0816bb895cdf504012"
			"68f5d702b7e6a5f9faef57b8768c8a3fc14f9a4b3182b41d940e337d219b29ff",
			"40a453133361cc48da11baf616ee"
		}, {
			"88e5258b55b1623385eb9632fa7c57d6",
			"ada76bb604be14326551701cf30e48a65eee80b44f0b9d4a07b1844543b7844a"
			"621097fdc99de57387458ae9354899b620d0617eabcaefa9eef3d413a3362805"
			"4335ce656c26fa2986e0f111a6351096b283101ec7868871d770b370973c7405"
			"983f9756b3005a3eab492cfd0e7eb42e5c2e15fa6be8718c0a50acc4e5717230",
			"81c783af538015cef3c60095df53"
		}, {
			"85d402d822114d31abf75526e2538705",
			"8020d8d98cc2e2298b32879c51c751e1dd5558fe2eabb8f158604297d6d072ce"
			"2261a1d6830b7cfe2617b57c7126f99c9476211d6161acd75d266da217ec8174"
			"b80484c9dc6f0448a0a036a3fc82e8bf54bdb71549368258d5d41f57978a4c26"
			"6b92e8783ef66350215573d99be4089144b383ad8f3222bae8f3bf80ffb1bb2b",
			"2aa0340ac9deafe3be38129daca0"
		}, {
			"545c6eecc5ee46fa17c59f91a94f81ae",
			"8fb7f3565593170152ddb2021874784e951977cfdd22f8b72a72a61320a8f2a3"
			"5697b5e913f717805559b1af1861ee3ed42fb788481e4fd276b17bdbefcae7b4"
			"501dc5d20de5b7626dd5efdcd65294db4bdf682c33d9a9255c6435383fa5f1c8"
			"86326a3acbc6bd50a33ab5b2dbb034ce0112d4e226bbcd57e3731a519aa1d784",
			"3eb566eac54c4a3a9ef092469f24"
		}, {
			"4466ab4dc438841a9750c7f173dff02e",
			"2534c11c78c99cffaec8f722f04adc7045c7324d58ce98e37cfa94b6ed21ed7f"
			"58ce55379ef24b72d6d640ee9154f96c614734be9c408e225d7ba4cecc1179cc"
			"9f6e1808e1067aa8f244a99bd0c3267594c1887a40d167f8b7cf78db0d19f97b"
			"01fc50b8c86def490dfa7a5135002c33e71d77a8cce8ea0f93e0580439a33733",
			"59f44a9bbed4875b892d22d6b5ab"
		}, {
			"0e3dd9bb5e4cf0f09a4c11600af56d8d",
			"f4589fa76c328ea25cf8bae582026ba40a59d45a546ff31cf80eb826088f69bb"
			"954c452c74586836416dee90a5255bc5d56d3b405b3705a5197045688b32fa98"
			"4c3a3dfbdc9c2460a0b5e6312a624048bb6f170306535e9b371a3ab134a2642a"
			"230ad03d2c688cca80baeaee9a20e1d4c548b1cede29c6a45bf4df2c8c476f1a",
			"12175b93e3da4c58217145e4dc0a1cf142fab9319bb501e037b350ba"
		}, {
			"cda5187b0c5dcb0f8e5a8beed2306584",
			"9011ae29b44c49b347487ce972965f16ade3c15be0856ce9c853a9739dba07e4"
			"f20d594ddc1dfe21560a65a4e458cfa17745575b915a30c7a9412ff8d1d689db"
			"9680dd2428c27588bb0dc92d2cd9445fe8f44b840a197c52c3c4333fff455339"
			"45134398df6436513cfab06c924046b8c795a5bd92e8d5f2de85bf306f2eed67",
			"4aaba92b40e2a600feab176eb9b292d814864195c03342aad6f67f08"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out_1[Crypto::HMAC<Crypto::SHA224>::SIZE];
		uint8_t out_2[Crypto::HMAC<Crypto::SHA224>::SIZE];
		std::string output_1, output_2;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC<Crypto::SHA224> ctx(key, key_sz);
		ctx.update(in, in_sz);
		ctx.reset();
		ctx.update(in, in_sz);
		ctx.finish(out_1);
		Crypto::Utils::to_hex(out_1, test[i][2].length() / 2, output_1, false);

		ctx.update(in, in_sz);
		ctx.finish(out_2);
		Crypto::Utils::to_hex(out_2, test[i][2].length() / 2, output_2, false);

		EXPECT_THAT(output_1, test[i][2]);
		EXPECT_THAT(output_2, test[i][2]);
	}
}

TEST(HMAC_SHA256, mac_test_vector)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"cdffd34e6b16fdc0",
			"d83e78b99ab61709608972b36e76a575603db742269cc5dd4e7d5ca7816e26b6"
			"5151c92632550cb4c5253c885d5fce53bc47459a1dbd5652786c4aac0145a532"
			"f12c05138af04cbb558101a7af5df478834c2146594dd73690d01a4fe7254589"
			"4335f427ac70204798068cb86c5a600b40b414ede23590b41e1192373df84fe3",
			"c6f0dde266cb4a26d41e8259d33499cc"
		}, {
			"6d97bb5892245be2",
			"13c2b391d59c0252ca5d2302beaaf88c4bcd779bb505ad9a122003dfae4cc123"
			"ad2bd036f225c4f040021a6b9fb8bd6f0281cf2e2631a732bdc71693cc42ef6d"
			"52b6c6912a9ef77b3274eb85ad7f965ae6ed44ac1721962a884ec7acfb4534b1"
			"488b1c0c45afa4dae8da1eb7b0a88a3240365d7e4e7d826abbde9f9203fd99d7",
			"31588e241b015319a5ab8c4527296498"
		}, {
			"3c7fc8a70b49007a",
			"60024e428a39c8b8bb2e9591bad9dc2115dfbfd716b6eb7af30a6eb34560cacc"
			"bbfa47b710fa8d523aca71e9e5ba10fc1feb1a43556d71f07ea4f33496f09304"
			"4e8caf1d02b79e46eb1288d5964a7a7494f6b92574c35784eece054c6151281d"
			"80822f7d47b8231c35d07f5cb5cf4310ddc844845a01c6bfab514c048eccaf9f",
			"1c98c94a32bec9f253c21070f82f8438"
		}, {
			"369f33f85b927a07",
			"ae8e2a94ca386d448cbacdb0e9040ae3cb297c296363052cc157455da29a0c95"
			"897315fc11e3f12b81e2418da1ec280bccbc00e847584ce9d14deeba7b3c9b8d"
			"ba958b04bba37551f6c9ba9c060be1a4b8cf43aa62e5078b76c6512c5619b71a"
			"6a7cf5727180e1ff14f5a1a3c1691bf8b6ebad365c151e58d749d57adb3a4986",
			"60b90383286533d309de46593e6ce39fc51fb00a8d88278c"
		}, {
			"e5179687582b4dc4",
			"ce103bdacdf32f614f6727bcb31ca1c2824a850d00f5585b016fb234fe1ef2cd"
			"687f302d3c6b738ed89a24060d65c36675d0d96307c72ef3e8a83bfa8402e226"
			"de9d5d1724ba75c4879bf41a4a465ce61887d9f49a34757849b48bae81c27ebe"
			"d76faae2ad669bca04747d409148d40812776e0ae2c395b3cb9c89981ce72d5c",
			"509581f6816df4b8cc9f2cf42b7cc6e6a5a1e375a16f2412"
		}, {
			"63cec6246aeb1b61",
			"c178db908a405fa88aa255b8cad22b4057016585f139ee930388b083d86062fa"
			"0b3ea1f23f8a43bd11bee8464bcbd19b5ab9f6a8038d5245516f8274d20c8ee3"
			"033a07b908da528fa00343bb595deed500cab9745c4cb6391c23300f0d3584b0"
			"90b3326c4cfa342620b78f9f5b4f27f7307ed770643ec1764aeae3dcf1a3ec69",
			"64f3dd861b7c7d29fce9ae0ce9ed954b5d7141806ee9eec7"
		}, {
			"6d97bb5892245be2",
			"13c2b391d59c0252ca5d2302beaaf88c4bcd779bb505ad9a122003dfae4cc123"
			"ad2bd036f225c4f040021a6b9fb8bd6f0281cf2e2631a732bdc71693cc42ef6d"
			"52b6c6912a9ef77b3274eb85ad7f965ae6ed44ac1721962a884ec7acfb4534b1"
			"488b1c0c45afa4dae8da1eb7b0a88a3240365d7e4e7d826abbde9f9203fd99d7",
			"31588e241b015319a5ab8c4527296498"
		}, {
			"3c7fc8a70b49007a",
			"60024e428a39c8b8bb2e9591bad9dc2115dfbfd716b6eb7af30a6eb34560cacc"
			"bbfa47b710fa8d523aca71e9e5ba10fc1feb1a43556d71f07ea4f33496f09304"
			"4e8caf1d02b79e46eb1288d5964a7a7494f6b92574c35784eece054c6151281d"
			"80822f7d47b8231c35d07f5cb5cf4310ddc844845a01c6bfab514c048eccaf9f",
			"1c98c94a32bec9f253c21070f82f8438"
		}, {
			"369f33f85b927a07",
			"ae8e2a94ca386d448cbacdb0e9040ae3cb297c296363052cc157455da29a0c95"
			"897315fc11e3f12b81e2418da1ec280bccbc00e847584ce9d14deeba7b3c9b8d"
			"ba958b04bba37551f6c9ba9c060be1a4b8cf43aa62e5078b76c6512c5619b71a"
			"6a7cf5727180e1ff14f5a1a3c1691bf8b6ebad365c151e58d749d57adb3a4986",
			"60b90383286533d309de46593e6ce39fc51fb00a8d88278c"
		}, {
			"e5179687582b4dc4",
			"ce103bdacdf32f614f6727bcb31ca1c2824a850d00f5585b016fb234fe1ef2cd"
			"687f302d3c6b738ed89a24060d65c36675d0d96307c72ef3e8a83bfa8402e226"
			"de9d5d1724ba75c4879bf41a4a465ce61887d9f49a34757849b48bae81c27ebe"
			"d76faae2ad669bca04747d409148d40812776e0ae2c395b3cb9c89981ce72d5c",
			"509581f6816df4b8cc9f2cf42b7cc6e6a5a1e375a16f2412"
		}, {
			"63cec6246aeb1b61",
			"c178db908a405fa88aa255b8cad22b4057016585f139ee930388b083d86062fa"
			"0b3ea1f23f8a43bd11bee8464bcbd19b5ab9f6a8038d5245516f8274d20c8ee3"
			"033a07b908da528fa00343bb595deed500cab9745c4cb6391c23300f0d3584b0"
			"90b3326c4cfa342620b78f9f5b4f27f7307ed770643ec1764aeae3dcf1a3ec69",
			"64f3dd861b7c7d29fce9ae0ce9ed954b5d7141806ee9eec7"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out[Crypto::HMAC<Crypto::SHA256>::SIZE];
		std::string output;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC_get<Crypto::SHA256>(key, key_sz, in, in_sz, out);
		Crypto::Utils::to_hex(out, test[i][2].length() / 2, output, false);

		EXPECT_THAT(output, test[i][2]);
	}
}

TEST(HMAC_SHA256, reset_ctx)
{
	const std::vector<std::vector<std::string>> test = {
		{
			"cdffd34e6b16fdc0",
			"d83e78b99ab61709608972b36e76a575603db742269cc5dd4e7d5ca7816e26b6"
			"5151c92632550cb4c5253c885d5fce53bc47459a1dbd5652786c4aac0145a532"
			"f12c05138af04cbb558101a7af5df478834c2146594dd73690d01a4fe7254589"
			"4335f427ac70204798068cb86c5a600b40b414ede23590b41e1192373df84fe3",
			"c6f0dde266cb4a26d41e8259d33499cc"
		}, {
			"6d97bb5892245be2",
			"13c2b391d59c0252ca5d2302beaaf88c4bcd779bb505ad9a122003dfae4cc123"
			"ad2bd036f225c4f040021a6b9fb8bd6f0281cf2e2631a732bdc71693cc42ef6d"
			"52b6c6912a9ef77b3274eb85ad7f965ae6ed44ac1721962a884ec7acfb4534b1"
			"488b1c0c45afa4dae8da1eb7b0a88a3240365d7e4e7d826abbde9f9203fd99d7",
			"31588e241b015319a5ab8c4527296498"
		}, {
			"3c7fc8a70b49007a",
			"60024e428a39c8b8bb2e9591bad9dc2115dfbfd716b6eb7af30a6eb34560cacc"
			"bbfa47b710fa8d523aca71e9e5ba10fc1feb1a43556d71f07ea4f33496f09304"
			"4e8caf1d02b79e46eb1288d5964a7a7494f6b92574c35784eece054c6151281d"
			"80822f7d47b8231c35d07f5cb5cf4310ddc844845a01c6bfab514c048eccaf9f",
			"1c98c94a32bec9f253c21070f82f8438"
		}, {
			"369f33f85b927a07",
			"ae8e2a94ca386d448cbacdb0e9040ae3cb297c296363052cc157455da29a0c95"
			"897315fc11e3f12b81e2418da1ec280bccbc00e847584ce9d14deeba7b3c9b8d"
			"ba958b04bba37551f6c9ba9c060be1a4b8cf43aa62e5078b76c6512c5619b71a"
			"6a7cf5727180e1ff14f5a1a3c1691bf8b6ebad365c151e58d749d57adb3a4986",
			"60b90383286533d309de46593e6ce39fc51fb00a8d88278c"
		}, {
			"e5179687582b4dc4",
			"ce103bdacdf32f614f6727bcb31ca1c2824a850d00f5585b016fb234fe1ef2cd"
			"687f302d3c6b738ed89a24060d65c36675d0d96307c72ef3e8a83bfa8402e226"
			"de9d5d1724ba75c4879bf41a4a465ce61887d9f49a34757849b48bae81c27ebe"
			"d76faae2ad669bca04747d409148d40812776e0ae2c395b3cb9c89981ce72d5c",
			"509581f6816df4b8cc9f2cf42b7cc6e6a5a1e375a16f2412"
		}, {
			"63cec6246aeb1b61",
			"c178db908a405fa88aa255b8cad22b4057016585f139ee930388b083d86062fa"
			"0b3ea1f23f8a43bd11bee8464bcbd19b5ab9f6a8038d5245516f8274d20c8ee3"
			"033a07b908da528fa00343bb595deed500cab9745c4cb6391c23300f0d3584b0"
			"90b3326c4cfa342620b78f9f5b4f27f7307ed770643ec1764aeae3dcf1a3ec69",
			"64f3dd861b7c7d29fce9ae0ce9ed954b5d7141806ee9eec7"
		}, {
			"6d97bb5892245be2",
			"13c2b391d59c0252ca5d2302beaaf88c4bcd779bb505ad9a122003dfae4cc123"
			"ad2bd036f225c4f040021a6b9fb8bd6f0281cf2e2631a732bdc71693cc42ef6d"
			"52b6c6912a9ef77b3274eb85ad7f965ae6ed44ac1721962a884ec7acfb4534b1"
			"488b1c0c45afa4dae8da1eb7b0a88a3240365d7e4e7d826abbde9f9203fd99d7",
			"31588e241b015319a5ab8c4527296498"
		}, {
			"3c7fc8a70b49007a",
			"60024e428a39c8b8bb2e9591bad9dc2115dfbfd716b6eb7af30a6eb34560cacc"
			"bbfa47b710fa8d523aca71e9e5ba10fc1feb1a43556d71f07ea4f33496f09304"
			"4e8caf1d02b79e46eb1288d5964a7a7494f6b92574c35784eece054c6151281d"
			"80822f7d47b8231c35d07f5cb5cf4310ddc844845a01c6bfab514c048eccaf9f",
			"1c98c94a32bec9f253c21070f82f8438"
		}, {
			"369f33f85b927a07",
			"ae8e2a94ca386d448cbacdb0e9040ae3cb297c296363052cc157455da29a0c95"
			"897315fc11e3f12b81e2418da1ec280bccbc00e847584ce9d14deeba7b3c9b8d"
			"ba958b04bba37551f6c9ba9c060be1a4b8cf43aa62e5078b76c6512c5619b71a"
			"6a7cf5727180e1ff14f5a1a3c1691bf8b6ebad365c151e58d749d57adb3a4986",
			"60b90383286533d309de46593e6ce39fc51fb00a8d88278c"
		}, {
			"e5179687582b4dc4",
			"ce103bdacdf32f614f6727bcb31ca1c2824a850d00f5585b016fb234fe1ef2cd"
			"687f302d3c6b738ed89a24060d65c36675d0d96307c72ef3e8a83bfa8402e226"
			"de9d5d1724ba75c4879bf41a4a465ce61887d9f49a34757849b48bae81c27ebe"
			"d76faae2ad669bca04747d409148d40812776e0ae2c395b3cb9c89981ce72d5c",
			"509581f6816df4b8cc9f2cf42b7cc6e6a5a1e375a16f2412"
		}, {
			"63cec6246aeb1b61",
			"c178db908a405fa88aa255b8cad22b4057016585f139ee930388b083d86062fa"
			"0b3ea1f23f8a43bd11bee8464bcbd19b5ab9f6a8038d5245516f8274d20c8ee3"
			"033a07b908da528fa00343bb595deed500cab9745c4cb6391c23300f0d3584b0"
			"90b3326c4cfa342620b78f9f5b4f27f7307ed770643ec1764aeae3dcf1a3ec69",
			"64f3dd861b7c7d29fce9ae0ce9ed954b5d7141806ee9eec7"
		}
	};

	for ( std::size_t i = 0 ; i < test.size() ; ++i ) {
		uint8_t key[2048];
		std::size_t key_sz = sizeof(key);
		uint8_t in[2048];
		std::size_t in_sz = sizeof(in);
		uint8_t out_1[Crypto::HMAC<Crypto::SHA256>::SIZE];
		uint8_t out_2[Crypto::HMAC<Crypto::SHA256>::SIZE];
		std::string output_1, output_2;

		Crypto::Utils::from_hex(test[i][0], key, key_sz);
		Crypto::Utils::from_hex(test[i][1], in,  in_sz);

		Crypto::HMAC<Crypto::SHA256> ctx(key, key_sz);
		ctx.update(in, in_sz);
		ctx.reset();
		ctx.update(in, in_sz);
		ctx.finish(out_1);
		Crypto::Utils::to_hex(out_1, test[i][2].length() / 2, output_1, false);

		ctx.update(in, in_sz);
		ctx.finish(out_2);
		Crypto::Utils::to_hex(out_2, test[i][2].length() / 2, output_2, false);

		EXPECT_THAT(output_1, test[i][2]);
		EXPECT_THAT(output_2, test[i][2]);
	}
}
